{% extends '_base.html' %} {% block content %}

<div class="app-body">
	<!--TODO SIGN IN/OUT... Login Name replaces "Hi First Last"-->
	<h1 class="current-date">
		Hi, <span class="welcome-name">First Last</span>! -- Today is {{today}}
		<em>- WORK IN PROGRESS -</em>
	</h1>
	<div class="birthday-form">
		<form method="post" action="/push">
			<table>
				<th colspan="4" class="birthday-title">Upcoming Birthdays!</th>
				{% for birthday in birthdays %}
				<tr>
					<td class="birthday-name">{{ birthday.name }}</td>
					<td class="birthday-date">{{ birthday.get_formatted_date() }}</td>
					{% set countdown = birthday.get_countdown() %} {% if countdown is
					equalto 0 %}
					<td class="birthday-countdown" priority="0">Today!</td>
					{% else %}
					<td class="birthday-countdown">in {{countdown}} days!</td>
					{% endif %}
					<td>
						<a
							class="delete-bd"
							href="/delete-birthday?id={{ birthday.entity_id }}"
							>delete</a
						>
					</td>
				</tr>
				{% else %}
				<tr>
					<td colspan="4">No birthdays to list.</td>
				</tr>
				{% endfor %}
				<tr>
					<td><input type="text" name="name" value="{{name}}" /></td>
					<td><input type="date" name="date" value="{{date}}" /></td>
					<td><input id="submit-bd" type="submit" /></td>
				</tr>
			</table>
		</form>
	</div>
	<!-- COLOR PRIORITY -->
	<script>
		let elements = document.getElementsByClassName("birthday-countdown");
		for (let i = 0; i < elements.length; i++) {
			if (elements[i].getAttribute("priority") == "0") {
				elements[i].style.backgroundColor = `rgba(250,82,98,${i + 1})`;
			} else {
				elements[i].setAttribute("priority", i);
				elements[i].style.backgroundColor = `rgba(250,82,98,${1 / (i + 1)})`;
			}
		}
	</script>
	<!-- JS-CONFETTI -->
	<script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
	<script>
		const jsConfetti = new JSConfetti();
		function confetti() {
			jsConfetti.addConfetti();
			console.log("Confetti loaded");
		}
		document
			.getElementById("submit-bd")
			.addEventListener("mouseover", confetti);
	</script>
	<!-- Submission Confirmation -->
	<script type="text/javascript">
		var deletebuttons = document.getElementsByClassName("delete-bd");

		for (var i = 0; i < deletebuttons.length; i++) {
			deletebuttons[i].onclick = function (a) {
				if (!confirm("Are you sure you want to delete this birthday?")) {
					a.preventDefault();
				}
			};
		}
	</script>
</div>

{% endblock %}
